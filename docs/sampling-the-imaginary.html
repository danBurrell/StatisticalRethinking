<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Sampling the imaginary | Mulling Over McElreath’s Statistical Rethinking</title>
  <meta name="description" content="My journey working through McElreath’s Statistical Rethinking text" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Sampling the imaginary | Mulling Over McElreath’s Statistical Rethinking" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://danburrell.github.io/StatisticalRethinking/" />
  
  <meta property="og:description" content="My journey working through McElreath’s Statistical Rethinking text" />
  <meta name="github-repo" content="danBurrell/StatisticalRethinking" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Sampling the imaginary | Mulling Over McElreath’s Statistical Rethinking" />
  
  <meta name="twitter:description" content="My journey working through McElreath’s Statistical Rethinking text" />
  

<meta name="author" content="Dan Burrell" />


<meta name="date" content="2020-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="small-worlds-and-large-worlds.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mulling Over McElreath's Statistical Musings</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Before you start, you should do these things</a></li>
<li class="chapter" data-level="2" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html"><i class="fa fa-check"></i><b>2</b> The Golem of Prague</a><ul>
<li class="chapter" data-level="2.1" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html#hypotheses-are-not-models"><i class="fa fa-check"></i><b>2.1</b> Hypotheses are not models</a></li>
<li class="chapter" data-level="2.2" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html#measurement-matters"><i class="fa fa-check"></i><b>2.2</b> Measurement matters</a><ul>
<li class="chapter" data-level="2.2.1" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html#observaqtion-error"><i class="fa fa-check"></i><b>2.2.1</b> Observaqtion error</a></li>
<li class="chapter" data-level="2.2.2" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html#continuous-hypotheses"><i class="fa fa-check"></i><b>2.2.2</b> Continuous hypotheses</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="theGolemOfPrague.html"><a href="theGolemOfPrague.html#tools-for-golem-engineering"><i class="fa fa-check"></i><b>2.3</b> Tools for golem engineering</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>3</b> Small Worlds and Large Worlds</a><ul>
<li class="chapter" data-level="3.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#end-of-chapter-exercises"><i class="fa fa-check"></i><b>3.1</b> End of chapter exercises</a><ul>
<li class="chapter" data-level="3.1.1" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1."><i class="fa fa-check"></i><b>3.1.1</b> 2H1.</a></li>
<li class="chapter" data-level="3.1.2" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2."><i class="fa fa-check"></i><b>3.1.2</b> 2H2.</a></li>
<li class="chapter" data-level="3.1.3" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3."><i class="fa fa-check"></i><b>3.1.3</b> 2H3.</a></li>
<li class="chapter" data-level="3.1.4" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4."><i class="fa fa-check"></i><b>3.1.4</b> 2H4.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i><b>4</b> Sampling the imaginary</a><ul>
<li class="chapter" data-level="4.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid-approximate posterior</a><ul>
<li class="chapter" data-level="4.1.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i><b>4.1.1</b> Intervals of defined boundaries</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#chapter-3-practice-problems"><i class="fa fa-check"></i><b>4.2</b> Chapter 3 Practice Problems</a><ul>
<li class="chapter" data-level="4.2.1" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e1."><i class="fa fa-check"></i><b>4.2.1</b> 3E1.</a></li>
<li class="chapter" data-level="4.2.2" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e2."><i class="fa fa-check"></i><b>4.2.2</b> 3E2.</a></li>
<li class="chapter" data-level="4.2.3" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e3."><i class="fa fa-check"></i><b>4.2.3</b> 3E3.</a></li>
<li class="chapter" data-level="4.2.4" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e4."><i class="fa fa-check"></i><b>4.2.4</b> 3E4.</a></li>
<li class="chapter" data-level="4.2.5" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e5."><i class="fa fa-check"></i><b>4.2.5</b> 3E5.</a></li>
<li class="chapter" data-level="4.2.6" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e6."><i class="fa fa-check"></i><b>4.2.6</b> 3E6.</a></li>
<li class="chapter" data-level="4.2.7" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#e7."><i class="fa fa-check"></i><b>4.2.7</b> 3E7.</a></li>
<li class="chapter" data-level="4.2.8" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m1."><i class="fa fa-check"></i><b>4.2.8</b> 3M1.</a></li>
<li class="chapter" data-level="4.2.9" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m2."><i class="fa fa-check"></i><b>4.2.9</b> 3M2.</a></li>
<li class="chapter" data-level="4.2.10" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m3."><i class="fa fa-check"></i><b>4.2.10</b> 3M3.</a></li>
<li class="chapter" data-level="4.2.11" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m4."><i class="fa fa-check"></i><b>4.2.11</b> 3M4.</a></li>
<li class="chapter" data-level="4.2.12" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m5."><i class="fa fa-check"></i><b>4.2.12</b> 3M5.</a></li>
<li class="chapter" data-level="4.2.13" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#m6."><i class="fa fa-check"></i><b>4.2.13</b> 3M6.</a></li>
<li class="chapter" data-level="4.2.14" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h1."><i class="fa fa-check"></i><b>4.2.14</b> 3H1.</a></li>
<li class="chapter" data-level="4.2.15" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h2."><i class="fa fa-check"></i><b>4.2.15</b> 3H2.</a></li>
<li class="chapter" data-level="4.2.16" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h3."><i class="fa fa-check"></i><b>4.2.16</b> 3H3.</a></li>
<li class="chapter" data-level="4.2.17" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#h4."><i class="fa fa-check"></i><b>4.2.17</b> 3H4.</a></li>
<li class="chapter" data-level="4.2.18" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#h5."><i class="fa fa-check"></i><b>4.2.18</b> 3H5.</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mulling Over McElreath’s Statistical Rethinking</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sampling-the-imaginary" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Sampling the imaginary</h1>
<p>There is a blood test that correctly detects vampirism <span class="math inline">\(95\%\)</span> of the time and incorrectly diagnoses normal people as vampires <span class="math inline">\(1\%\)</span> of the time. Letting <span class="math inline">\(v\)</span> denote being a vampire and <span class="math inline">\(h\)</span> denote being human (not vampire) and <span class="math inline">\(+\)</span> denote testing positive for vampirism, and <span class="math inline">\(-\)</span> denote testing negative for vampirism, then we have:
<span class="math display">\[
\begin{aligned}
\mathbb P(+|v) &amp;= 0.95 \\
\mathbb P(-|v) &amp;= 0.05 \\
\mathbb P(+|h) &amp;= 0.01 \\
\mathbb P(-|h) &amp;= 0.99 \\
\end{aligned}
\]</span>
Suppose that vampires are quite rare, comprising only <span class="math inline">\(0.1\%\)</span> of the population. That is <span class="math inline">\(\mathbb P(v) = 0.001\)</span>.</p>
<p>Now suppose someone tests positive for vampirism. What’s the actual probability that he/she is really a vampire?</p>
<p>Using Bayes’ theorem this is simple. We want <span class="math inline">\(\mathbb P(v|+)\)</span> and we can find it through probability inversion as follows:
<span class="math display">\[
\begin{aligned}
\mathbb P(v|+) &amp;= \frac{\mathbb P(+|v) \mathbb P(v)}{P(+)} \\
&amp;= \frac{\mathbb P(+|v) \mathbb P(v)}{\mathbb P(+|v)\mathbb P(v) + \mathbb P(+|h)\mathbb P(h)} \\
&amp;= \frac{0.95\times 0.001}{0.95\times 0.001 + 0.01 \times 0.999} \\
&amp;= 0.08683729
\end{aligned}
\]</span>
The calculations can be carried out easily in R:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="sampling-the-imaginary.html#cb23-1"></a>p_pos_v =<span class="st"> </span><span class="fl">0.95</span></span>
<span id="cb23-2"><a href="sampling-the-imaginary.html#cb23-2"></a>p_pos_h =<span class="st"> </span><span class="fl">0.01</span></span>
<span id="cb23-3"><a href="sampling-the-imaginary.html#cb23-3"></a>p_neg_v =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_pos_v</span>
<span id="cb23-4"><a href="sampling-the-imaginary.html#cb23-4"></a>p_neg_h =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_pos_h</span>
<span id="cb23-5"><a href="sampling-the-imaginary.html#cb23-5"></a>p_v =<span class="st"> </span><span class="fl">0.001</span></span>
<span id="cb23-6"><a href="sampling-the-imaginary.html#cb23-6"></a>p_h =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_v</span>
<span id="cb23-7"><a href="sampling-the-imaginary.html#cb23-7"></a></span>
<span id="cb23-8"><a href="sampling-the-imaginary.html#cb23-8"></a>p_pos =<span class="st"> </span>p_pos_v <span class="op">*</span><span class="st"> </span>p_v <span class="op">+</span><span class="st"> </span>p_pos_h <span class="op">*</span><span class="st"> </span>p_h </span>
<span id="cb23-9"><a href="sampling-the-imaginary.html#cb23-9"></a>p_v_pos =<span class="st"> </span>p_pos_v <span class="op">*</span><span class="st"> </span>p_v <span class="op">/</span><span class="st"> </span>p_pos</span>
<span id="cb23-10"><a href="sampling-the-imaginary.html#cb23-10"></a></span>
<span id="cb23-11"><a href="sampling-the-imaginary.html#cb23-11"></a><span class="kw">print</span>(p_v_pos)</span></code></pre></div>
<pre><code>## [1] 0.08683729</code></pre>
<p>There is (only) an <span class="math inline">\(8.7\%\)</span> that the tested person is actually a vampire. Whenever the condition of interest is very rare, having a test that finds all the true cases is still no guarantee that a positive result carries much information at all. Why? Because most positive tests are false positives, even when all the true positives are detected correctly.</p>
<p>The above results seems counter-intuitive. But there’s a way to frame it — in terms of frequencies — that makes it far easier. Suppose we have 100000 people in the population and 100 of them are vampires. Of the 100 vampires, 95 of them would test positive for vampirism. Of the 99900 humans, 999 of them would test positive for vampirism.</p>
<p>Now, suppose we test the whole population, what proportion of those who test positive do you expect to actually be vampires? It’s simple now right:
<span class="math display">\[
\mathbb P(v|+) = \frac{95}{1094} \approx 0.087
\]</span>
Using frequencies makes things easier — and we exploit this fact when we sample from a posterior distribution.</p>
<div id="sampling-from-a-grid-approximate-posterior" class="section level2">
<h2><span class="header-section-number">4.1</span> Sampling from a grid-approximate posterior</h2>
<p>A globe-tossing model: You have a globe representing Earth and you’re curious about how much of the surface is covered in water. You will toss the globe in the air and catch it, and record whether or not the surface under your right index finger is water or land. Repeat the procedure some number of times and then look at the relative proportions of water to land. The first 9 observations are
<span class="math display">\[
W\;L\;W\;W\;W\;L\;W\;L\;W
\]</span>
Before we can work with samples, we need to generate them.</p>
<p>The data story is simply that the true proportion of water covering the globe is <span class="math inline">\(p\)</span>, a single toss of the globe has probability <span class="math inline">\(p\)</span> of producing water and probability <span class="math inline">\(1-p\)</span> of producing land, and each toss of the globe is independent of the others.</p>
<p>To translate the data story into a probability model: the counts of “water” and “land” are distributed binomially, with probability <span class="math inline">\(p\)</span> of water on each toss:
<span class="math display">\[
\mathbb P(W,L|p) = \frac{(W+L)!}{W!L!}p^W(1-p)^L.
\]</span>
A Bayesian model specifies a likelihood:
<span class="math display">\[
W \sim \text{Binomial}(N,p); \quad N = W + L
\]</span>
and a prior:
<span class="math display">\[
p \sim \text{Uniform}(0,1)
\]</span>
To actually process the data and model, to produce a posterior, we need an engine. Most real-world models don’t allow us to find analytical (pen and paper) solutions. Instead for small models we can use grid approximation, for moderately larger models we canuse quadratic approximation, and for proper real-world models we can use MCMC.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="sampling-the-imaginary.html#cb25-1"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(pacman)) <span class="kw">install.packages</span>(pacman)</span></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="sampling-the-imaginary.html#cb27-1"></a><span class="kw">library</span>(pacman)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="sampling-the-imaginary.html#cb28-1"></a>n_grid =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb28-2"><a href="sampling-the-imaginary.html#cb28-2"></a>grid_limits =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb28-3"><a href="sampling-the-imaginary.html#cb28-3"></a>p_grid =<span class="st"> </span><span class="kw">seq</span>( <span class="dt">from=</span>grid_limits[<span class="dv">1</span>], <span class="dt">to=</span>grid_limits[<span class="dv">2</span>], <span class="dt">length.out=</span>n_grid)</span>
<span id="cb28-4"><a href="sampling-the-imaginary.html#cb28-4"></a>prob_p =<span class="st"> </span><span class="kw">rep</span>( <span class="dv">1</span>, <span class="dv">1000</span>)</span>
<span id="cb28-5"><a href="sampling-the-imaginary.html#cb28-5"></a>prob_data =<span class="st"> </span><span class="kw">dbinom</span>( <span class="dv">6</span>, <span class="dt">size=</span><span class="dv">9</span>, <span class="dt">prob=</span>p_grid )</span>
<span id="cb28-6"><a href="sampling-the-imaginary.html#cb28-6"></a>posterior =<span class="st"> </span>prob_data <span class="op">*</span><span class="st"> </span>prob_p</span>
<span id="cb28-7"><a href="sampling-the-imaginary.html#cb28-7"></a>posterior =<span class="st"> </span>posterior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(posterior)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="sampling-the-imaginary.html#cb29-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(rethinking)</span>
<span id="cb29-2"><a href="sampling-the-imaginary.html#cb29-2"></a></span>
<span id="cb29-3"><a href="sampling-the-imaginary.html#cb29-3"></a>samples =<span class="st"> </span><span class="kw">sample</span>( p_grid, <span class="dt">prob=</span>posterior, <span class="dt">size=</span><span class="fl">1e4</span>, <span class="dt">replace=</span><span class="ot">TRUE</span> )</span>
<span id="cb29-4"><a href="sampling-the-imaginary.html#cb29-4"></a><span class="kw">plot</span>( samples )</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="sampling-the-imaginary.html#cb30-1"></a><span class="kw">dens</span>( samples )</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-4-2.png" width="672" />
## Sampling to summarize</p>
<div id="intervals-of-defined-boundaries" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Intervals of defined boundaries</h3>
<p>To get the proportion of water less than some value of <code>p_grid</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="sampling-the-imaginary.html#cb31-1"></a><span class="kw">sum</span>( samples <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span> ) <span class="op">/</span><span class="st"> </span><span class="fl">1e4</span></span></code></pre></div>
<pre><code>## [1] 0.1737</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="sampling-the-imaginary.html#cb33-1"></a><span class="kw">sum</span>( samples <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">&amp;</span><span class="st"> </span>samples <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.75</span> ) <span class="op">/</span><span class="st"> </span><span class="fl">1e4</span></span></code></pre></div>
<pre><code>## [1] 0.5984</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="sampling-the-imaginary.html#cb35-1"></a><span class="kw">quantile</span>( samples, <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>##       80% 
## 0.7617618</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="sampling-the-imaginary.html#cb37-1"></a><span class="kw">quantile</span>( samples, <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>) )</span></code></pre></div>
<pre><code>##       10%       90% 
## 0.4444444 0.8108108</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="sampling-the-imaginary.html#cb39-1"></a>n_grid =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb39-2"><a href="sampling-the-imaginary.html#cb39-2"></a>grid_limits =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb39-3"><a href="sampling-the-imaginary.html#cb39-3"></a>p_grid =<span class="st"> </span><span class="kw">seq</span>( <span class="dt">from=</span>grid_limits[<span class="dv">1</span>], <span class="dt">to=</span>grid_limits[<span class="dv">2</span>], <span class="dt">length.out=</span>n_grid)</span>
<span id="cb39-4"><a href="sampling-the-imaginary.html#cb39-4"></a>prior =<span class="st"> </span><span class="kw">rep</span>( <span class="dv">1</span>, n_grid)</span>
<span id="cb39-5"><a href="sampling-the-imaginary.html#cb39-5"></a>likelihood =<span class="st"> </span><span class="kw">dbinom</span>( <span class="dv">3</span>, <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">prob=</span>p_grid )</span>
<span id="cb39-6"><a href="sampling-the-imaginary.html#cb39-6"></a>posterior =<span class="st"> </span>likelihood <span class="op">*</span><span class="st"> </span>prior</span>
<span id="cb39-7"><a href="sampling-the-imaginary.html#cb39-7"></a>posterior =<span class="st"> </span>posterior <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(posterior)</span>
<span id="cb39-8"><a href="sampling-the-imaginary.html#cb39-8"></a>samples =<span class="st"> </span><span class="kw">sample</span>( p_grid, <span class="dt">size=</span><span class="fl">1e4</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">prob=</span>posterior )</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="sampling-the-imaginary.html#cb40-1"></a><span class="kw">PI</span>( samples, <span class="dt">prob=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##       25%       75% 
## 0.7057057 0.9289289</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="sampling-the-imaginary.html#cb42-1"></a><span class="kw">HPDI</span>( samples, <span class="dt">prob=</span><span class="fl">0.5</span> )</span></code></pre></div>
<pre><code>##      |0.5      0.5| 
## 0.8368368 0.9989990</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="sampling-the-imaginary.html#cb44-1"></a>p_grid[ <span class="kw">which.max</span>(posterior) ]</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="sampling-the-imaginary.html#cb46-1"></a><span class="kw">chainmode</span>( samples, <span class="dt">adj=</span><span class="fl">0.01</span> )</span></code></pre></div>
<pre><code>## [1] 0.9851767</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="sampling-the-imaginary.html#cb48-1"></a><span class="kw">mean</span>( samples )</span></code></pre></div>
<pre><code>## [1] 0.7992729</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="sampling-the-imaginary.html#cb50-1"></a><span class="kw">median</span>( samples )</span></code></pre></div>
<pre><code>## [1] 0.8378378</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="sampling-the-imaginary.html#cb52-1"></a><span class="kw">sum</span>( posterior <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>( <span class="fl">0.5</span> <span class="op">-</span><span class="st"> </span>p_grid ) )</span></code></pre></div>
<pre><code>## [1] 0.3128752</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="sampling-the-imaginary.html#cb54-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(purrr)</span>
<span id="cb54-2"><a href="sampling-the-imaginary.html#cb54-2"></a></span>
<span id="cb54-3"><a href="sampling-the-imaginary.html#cb54-3"></a>loss =<span class="st"> </span><span class="kw">map_dbl</span>( </span>
<span id="cb54-4"><a href="sampling-the-imaginary.html#cb54-4"></a>    p_grid, </span>
<span id="cb54-5"><a href="sampling-the-imaginary.html#cb54-5"></a>    <span class="cf">function</span>(d){ <span class="kw">sum</span>( posterior <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>( d <span class="op">-</span><span class="st"> </span>p_grid ) ) } )</span>
<span id="cb54-6"><a href="sampling-the-imaginary.html#cb54-6"></a></span>
<span id="cb54-7"><a href="sampling-the-imaginary.html#cb54-7"></a>p_grid[ <span class="kw">which.min</span>(loss) ]</span></code></pre></div>
<pre><code>## [1] 0.8408408</code></pre>
<p>Generating dummy data: suppose we have two tosses and the probability of water is 0.7: <span class="math inline">\((N=2, p = 0.7)\)</span>. To compute the probability of the possible outcomes:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="sampling-the-imaginary.html#cb56-1"></a>N =<span class="st"> </span><span class="dv">9</span></span>
<span id="cb56-2"><a href="sampling-the-imaginary.html#cb56-2"></a>p =<span class="st"> </span><span class="fl">0.7</span></span>
<span id="cb56-3"><a href="sampling-the-imaginary.html#cb56-3"></a>w =<span class="st"> </span><span class="dv">0</span><span class="op">:</span>N</span>
<span id="cb56-4"><a href="sampling-the-imaginary.html#cb56-4"></a>probs =<span class="st"> </span><span class="kw">dbinom</span>( w, <span class="dt">size=</span>N, <span class="dt">prob=</span>p)</span></code></pre></div>
<p>This tells us that there is a <span class="math inline">\(9\%\)</span> chance that <span class="math inline">\(w=0\)</span>, a <span class="math inline">\(42\%\)</span> chance that <span class="math inline">\(w=1\)</span> and a <span class="math inline">\(49\%\)</span> chance that <span class="math inline">\(w=2\)</span>.</p>
<p>Let’s simulate observations now using these probabilities:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="sampling-the-imaginary.html#cb57-1"></a>n_samples =<span class="st"> </span><span class="fl">1e6</span></span>
<span id="cb57-2"><a href="sampling-the-imaginary.html#cb57-2"></a>dummy_w =<span class="st"> </span><span class="kw">rbinom</span>(n_samples, <span class="dt">size=</span>N, <span class="dt">prob=</span>p )</span>
<span id="cb57-3"><a href="sampling-the-imaginary.html#cb57-3"></a><span class="kw">table</span>(dummy_w)<span class="op">/</span>n_samples</span></code></pre></div>
<pre><code>## dummy_w
##        0        1        2        3        4        5        6        7 
## 0.000018 0.000396 0.003934 0.021034 0.073673 0.171391 0.266765 0.267270 
##        8        9 
## 0.155119 0.040400</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="sampling-the-imaginary.html#cb59-1"></a><span class="kw">simplehist</span>( dummy_w, <span class="dt">xlab=</span><span class="st">&quot;dummy water count&quot;</span> )</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="sampling-the-imaginary.html#cb60-1"></a>w =<span class="st"> </span><span class="kw">rbinom</span>( n_samples, <span class="dt">size=</span>N, <span class="dt">prob=</span>samples)</span>
<span id="cb60-2"><a href="sampling-the-imaginary.html#cb60-2"></a><span class="kw">simplehist</span>(w)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="chapter-3-practice-problems" class="section level2">
<h2><span class="header-section-number">4.2</span> Chapter 3 Practice Problems</h2>
<p>The easy problems all use the following code:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="sampling-the-imaginary.html#cb61-1"></a><span class="kw">require</span>(rethinking)</span>
<span id="cb61-2"><a href="sampling-the-imaginary.html#cb61-2"></a>p_grid &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">1</span>, <span class="dt">length.out=</span><span class="dv">1000</span>)  </span>
<span id="cb61-3"><a href="sampling-the-imaginary.html#cb61-3"></a>prior &lt;-<span class="st"> </span><span class="kw">rep</span>( <span class="dv">1</span>, <span class="dv">1000</span>)  </span>
<span id="cb61-4"><a href="sampling-the-imaginary.html#cb61-4"></a>likelihood &lt;-<span class="st"> </span><span class="kw">dbinom</span>( <span class="dv">6</span>, <span class="dt">size=</span><span class="dv">9</span>, <span class="dt">prob=</span>p_grid)  </span>
<span id="cb61-5"><a href="sampling-the-imaginary.html#cb61-5"></a>posterior &lt;-<span class="st"> </span>likelihood <span class="op">*</span><span class="st"> </span>prior  </span>
<span id="cb61-6"><a href="sampling-the-imaginary.html#cb61-6"></a>posterior &lt;-<span class="st"> </span>posterior<span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(posterior) </span>
<span id="cb61-7"><a href="sampling-the-imaginary.html#cb61-7"></a><span class="kw">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb61-8"><a href="sampling-the-imaginary.html#cb61-8"></a>samples &lt;-<span class="st"> </span><span class="kw">sample</span>(p_grid, <span class="dt">prob=</span>posterior, <span class="dt">size=</span><span class="fl">1e4</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb61-9"><a href="sampling-the-imaginary.html#cb61-9"></a><span class="kw">dens</span>(samples)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-12-1.png" width="672" />
Use the values in <code>samples</code> to answer the following questions:</p>
<div id="e1." class="section level3">
<h3><span class="header-section-number">4.2.1</span> 3E1.</h3>
<p>How much posterior probability lies below p = 0.2?</p>
<p><strong>Solution</strong>
This is just asking for the sum of probabilities <span class="math inline">\(&lt;0.2\)</span>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="sampling-the-imaginary.html#cb62-1"></a><span class="co"># Using samples from posterior</span></span>
<span id="cb62-2"><a href="sampling-the-imaginary.html#cb62-2"></a>sp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( samples <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.2</span> ) <span class="op">/</span><span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb62-3"><a href="sampling-the-imaginary.html#cb62-3"></a></span>
<span id="cb62-4"><a href="sampling-the-imaginary.html#cb62-4"></a><span class="co"># cf. grid-approximate posterior</span></span>
<span id="cb62-5"><a href="sampling-the-imaginary.html#cb62-5"></a>gp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( posterior[ p_grid <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.2</span> ])</span>
<span id="cb62-6"><a href="sampling-the-imaginary.html#cb62-6"></a></span>
<span id="cb62-7"><a href="sampling-the-imaginary.html#cb62-7"></a><span class="kw">paste</span>(<span class="st">&quot;The samples give &quot;</span>, <span class="kw">round</span>(sp,<span class="dv">4</span>), <span class="st">&quot;% less than 0.2, while the grid-approximate posterior indicates &quot;</span>, <span class="kw">round</span>(gp,<span class="dv">4</span>), <span class="st">&quot;% less than 0.2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The samples give  0.04 % less than 0.2, while the grid-approximate posterior indicates  0.0856 % less than 0.2&quot;</code></pre>
</div>
<div id="e2." class="section level3">
<h3><span class="header-section-number">4.2.2</span> 3E2.</h3>
<p>How much posterior probability lies above p = 0.8?</p>
<p><strong>Solution</strong>
This is just asking for the sum of probabilities on <span class="math inline">\(&gt; 0.8\)</span></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="sampling-the-imaginary.html#cb64-1"></a><span class="co"># Using samples from posterior</span></span>
<span id="cb64-2"><a href="sampling-the-imaginary.html#cb64-2"></a>sp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( samples <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.8</span> ) <span class="op">/</span><span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb64-3"><a href="sampling-the-imaginary.html#cb64-3"></a></span>
<span id="cb64-4"><a href="sampling-the-imaginary.html#cb64-4"></a><span class="co"># cf. grid-approximate posterior</span></span>
<span id="cb64-5"><a href="sampling-the-imaginary.html#cb64-5"></a>gp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( posterior[ p_grid <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.8</span> ])</span>
<span id="cb64-6"><a href="sampling-the-imaginary.html#cb64-6"></a></span>
<span id="cb64-7"><a href="sampling-the-imaginary.html#cb64-7"></a><span class="kw">paste</span>(<span class="st">&quot;The samples give &quot;</span>, <span class="kw">round</span>(sp,<span class="dv">4</span>), <span class="st">&quot;% greater than 0.8, while the grid-approximate posterior indicates &quot;</span>, <span class="kw">round</span>(gp,<span class="dv">4</span>), <span class="st">&quot;% greater than 0.8&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The samples give  11.16 % greater than 0.8, while the grid-approximate posterior indicates  12.0345 % greater than 0.8&quot;</code></pre>
</div>
<div id="e3." class="section level3">
<h3><span class="header-section-number">4.2.3</span> 3E3.</h3>
<p>How much posterior probability lies between p = 0.2 and p = 0.8?</p>
<p><strong>Solution</strong>
This is just asking for the sum of probabilities on <span class="math inline">\(&gt; 0.2\; \&amp;\; &lt;0.8\)</span></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="sampling-the-imaginary.html#cb66-1"></a><span class="co"># samples</span></span>
<span id="cb66-2"><a href="sampling-the-imaginary.html#cb66-2"></a>sp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( samples <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">&amp;</span><span class="st"> </span>samples <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.8</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb66-3"><a href="sampling-the-imaginary.html#cb66-3"></a></span>
<span id="cb66-4"><a href="sampling-the-imaginary.html#cb66-4"></a><span class="co"># grid-approximate</span></span>
<span id="cb66-5"><a href="sampling-the-imaginary.html#cb66-5"></a>gp =<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>( posterior[ p_grid <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">&amp;</span><span class="st"> </span>p_grid <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.8</span> ])</span>
<span id="cb66-6"><a href="sampling-the-imaginary.html#cb66-6"></a></span>
<span id="cb66-7"><a href="sampling-the-imaginary.html#cb66-7"></a><span class="kw">paste</span>(<span class="st">&quot;The samples give&quot;</span>, <span class="kw">round</span>(sp,<span class="dv">4</span>), <span class="st">&quot;% in (0.2, 0.8), while the grid-approximate posterior indicates&quot;</span>, <span class="kw">round</span>(gp,<span class="dv">4</span>), <span class="st">&quot;% in (0.2, 0.8)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The samples give 88.8 % in (0.2, 0.8), while the grid-approximate posterior indicates 87.8799 % in (0.2, 0.8)&quot;</code></pre>
</div>
<div id="e4." class="section level3">
<h3><span class="header-section-number">4.2.4</span> 3E4.</h3>
<p>20% of the posterior probability lies below which value of p?</p>
<p><strong>Solution</strong>
This is just asking for the 20th percentile:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="sampling-the-imaginary.html#cb68-1"></a>q_<span class="dv">20</span> =<span class="st"> </span><span class="kw">quantile</span>( samples, <span class="fl">0.2</span>, <span class="dt">lower.tail=</span><span class="ot">TRUE</span>)</span>
<span id="cb68-2"><a href="sampling-the-imaginary.html#cb68-2"></a></span>
<span id="cb68-3"><a href="sampling-the-imaginary.html#cb68-3"></a><span class="kw">paste</span>(<span class="st">&quot;The 20th percentile is&quot;</span>, <span class="kw">round</span>(q_<span class="dv">20</span>, <span class="dv">2</span>), <span class="st">&quot;(to 2 dp)&quot;</span>) </span></code></pre></div>
<pre><code>## [1] &quot;The 20th percentile is 0.52 (to 2 dp)&quot;</code></pre>
</div>
<div id="e5." class="section level3">
<h3><span class="header-section-number">4.2.5</span> 3E5.</h3>
<p>20% of the posterior probability lies above which value of p?</p>
<p><strong>Solution</strong>
This is just asking for the (100 - 20)th = 80th percentile:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="sampling-the-imaginary.html#cb70-1"></a><span class="co"># from lower tail</span></span>
<span id="cb70-2"><a href="sampling-the-imaginary.html#cb70-2"></a>q_<span class="dv">80</span> =<span class="st"> </span><span class="kw">quantile</span>( samples, <span class="fl">0.8</span>, <span class="dt">lower.tail=</span><span class="ot">TRUE</span> )</span>
<span id="cb70-3"><a href="sampling-the-imaginary.html#cb70-3"></a></span>
<span id="cb70-4"><a href="sampling-the-imaginary.html#cb70-4"></a><span class="kw">paste</span>(<span class="st">&quot;The 80th percentile is&quot;</span>, <span class="kw">round</span>(q_<span class="dv">80</span>, <span class="dv">2</span>), <span class="st">&quot;(to 2 dp)&quot;</span>) </span></code></pre></div>
<pre><code>## [1] &quot;The 80th percentile is 0.76 (to 2 dp)&quot;</code></pre>
</div>
<div id="e6." class="section level3">
<h3><span class="header-section-number">4.2.6</span> 3E6.</h3>
<p>Which values of p contain the narrowest interval equal to 66% of the posterior probability?</p>
<p><strong>Solution</strong>
This is just asking for the 66% HPDI:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="sampling-the-imaginary.html#cb72-1"></a><span class="kw">require</span>(rethinking)</span>
<span id="cb72-2"><a href="sampling-the-imaginary.html#cb72-2"></a>HPDI_<span class="dv">66</span> =<span class="st"> </span><span class="kw">round</span>( <span class="kw">HPDI</span>( samples, <span class="dt">prob=</span><span class="fl">0.66</span> ), <span class="dv">2</span>)</span>
<span id="cb72-3"><a href="sampling-the-imaginary.html#cb72-3"></a>HPDI_<span class="dv">66</span></span></code></pre></div>
<pre><code>## |0.66 0.66| 
##  0.51  0.77</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="sampling-the-imaginary.html#cb74-1"></a><span class="kw">paste</span>(<span class="st">&quot;The narrowest interval containing 66% of the probabilitiy mass is the 66% HPDI: &quot;</span>, <span class="st">&quot;[&quot;</span>, HPDI_<span class="dv">66</span>[<span class="dv">1</span>],<span class="st">&quot;,&quot;</span>,HPDI_<span class="dv">66</span>[<span class="dv">2</span>], <span class="st">&quot;]&quot;</span>, <span class="st">&quot;, (to 2 dp)&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) </span></code></pre></div>
<pre><code>## [1] &quot;The narrowest interval containing 66% of the probabilitiy mass is the 66% HPDI: [0.51,0.77], (to 2 dp)&quot;</code></pre>
</div>
<div id="e7." class="section level3">
<h3><span class="header-section-number">4.2.7</span> 3E7.</h3>
<p>Which values of p contain 66% of the posterior probability, assuming equal posterior probability both below and above the interval?</p>
<p><strong>Solution</strong>
This is just asking for the 66% PI:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="sampling-the-imaginary.html#cb76-1"></a><span class="kw">require</span>(rethinking)</span>
<span id="cb76-2"><a href="sampling-the-imaginary.html#cb76-2"></a>PI_<span class="dv">66</span> =<span class="st"> </span><span class="kw">round</span>( <span class="kw">PI</span>( samples, <span class="dt">prob=</span><span class="fl">0.66</span> ), <span class="dv">2</span>)</span>
<span id="cb76-3"><a href="sampling-the-imaginary.html#cb76-3"></a>PI_<span class="dv">66</span></span></code></pre></div>
<pre><code>##  17%  83% 
## 0.50 0.77</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="sampling-the-imaginary.html#cb78-1"></a><span class="kw">paste</span>(<span class="st">&quot;The narrowest interval containing 66% of the probabilitiy mass is the 66% PI: &quot;</span>, <span class="st">&quot;[&quot;</span>, PI_<span class="dv">66</span>[<span class="dv">1</span>],<span class="st">&quot;,&quot;</span>,PI_<span class="dv">66</span>[<span class="dv">2</span>], <span class="st">&quot;]&quot;</span>, <span class="st">&quot;, (to 2 dp)&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) </span></code></pre></div>
<pre><code>## [1] &quot;The narrowest interval containing 66% of the probabilitiy mass is the 66% PI: [0.5,0.77], (to 2 dp)&quot;</code></pre>
</div>
<div id="m1." class="section level3">
<h3><span class="header-section-number">4.2.8</span> 3M1.</h3>
<p>Suppose the globe tossing data had turned out to be 8 water in 15 tosses. Construct the posterior distribution, using grid approximation. Use the same flat prior as before.</p>
<p><strong>Solution</strong>
First write a function so we can input any number of waters in any number of tosses — a bit more generic:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="sampling-the-imaginary.html#cb80-1"></a>globe_water_distn &lt;-<span class="st"> </span><span class="cf">function</span>(n_trials, n_water, <span class="dt">n_grid=</span><span class="fl">1e3</span>, <span class="dt">n_samples=</span><span class="fl">1e4</span>, <span class="dt">seed=</span><span class="dv">100</span>, <span class="dt">prior=</span><span class="kw">rep</span>(<span class="dv">1</span>, n_grid) ){</span>
<span id="cb80-2"><a href="sampling-the-imaginary.html#cb80-2"></a>    <span class="kw">set.seed</span>(seed)</span>
<span id="cb80-3"><a href="sampling-the-imaginary.html#cb80-3"></a>    p_grid =<span class="st"> </span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">1</span>, <span class="dt">length.out=</span>n_grid )  </span>
<span id="cb80-4"><a href="sampling-the-imaginary.html#cb80-4"></a>    prior =<span class="st"> </span>prior  </span>
<span id="cb80-5"><a href="sampling-the-imaginary.html#cb80-5"></a>    likelihood =<span class="st"> </span><span class="kw">dbinom</span>( n_water, <span class="dt">size=</span>n_trials, <span class="dt">prob=</span>p_grid ) </span>
<span id="cb80-6"><a href="sampling-the-imaginary.html#cb80-6"></a>    lp =<span class="st"> </span>likelihood <span class="op">*</span><span class="st"> </span>prior  </span>
<span id="cb80-7"><a href="sampling-the-imaginary.html#cb80-7"></a>    posterior =<span class="st"> </span>lp<span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(lp)</span>
<span id="cb80-8"><a href="sampling-the-imaginary.html#cb80-8"></a>    </span>
<span id="cb80-9"><a href="sampling-the-imaginary.html#cb80-9"></a>    out =<span class="st"> </span><span class="kw">list</span>(<span class="dt">p_grid =</span> p_grid, <span class="dt">prior =</span> prior, <span class="dt">likelihood =</span> likelihood, <span class="dt">posterior =</span> posterior)</span>
<span id="cb80-10"><a href="sampling-the-imaginary.html#cb80-10"></a>    <span class="kw">return</span>(out)</span>
<span id="cb80-11"><a href="sampling-the-imaginary.html#cb80-11"></a>}</span></code></pre></div>
<p>Now try it with <code>n_trials = 15</code> and <code>n_water = 8</code>:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="sampling-the-imaginary.html#cb81-1"></a>out =<span class="st"> </span><span class="kw">globe_water_distn</span>(<span class="dv">15</span>, <span class="dv">8</span>)</span></code></pre></div>
</div>
<div id="m2." class="section level3">
<h3><span class="header-section-number">4.2.9</span> 3M2.</h3>
<p>Draw 10,000 samples from the grid approximation from above. Then use the samples to calculate the 90% HPDI for p. </p>
<p><strong>Solution</strong></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="sampling-the-imaginary.html#cb82-1"></a><span class="kw">require</span>(rethinking)</span>
<span id="cb82-2"><a href="sampling-the-imaginary.html#cb82-2"></a>n_samples =<span class="st"> </span><span class="fl">1e5</span></span>
<span id="cb82-3"><a href="sampling-the-imaginary.html#cb82-3"></a>samples =<span class="st"> </span><span class="kw">sample</span>( out[[<span class="st">&quot;p_grid&quot;</span>]], </span>
<span id="cb82-4"><a href="sampling-the-imaginary.html#cb82-4"></a>                  <span class="dt">size=</span>n_samples, </span>
<span id="cb82-5"><a href="sampling-the-imaginary.html#cb82-5"></a>                  <span class="dt">replace=</span><span class="ot">TRUE</span>, </span>
<span id="cb82-6"><a href="sampling-the-imaginary.html#cb82-6"></a>                  <span class="dt">prob=</span>out[[<span class="st">&quot;posterior&quot;</span>]])</span>
<span id="cb82-7"><a href="sampling-the-imaginary.html#cb82-7"></a></span>
<span id="cb82-8"><a href="sampling-the-imaginary.html#cb82-8"></a>hpdi90_<span class="dv">1</span> =<span class="st"> </span><span class="kw">HPDI</span>( samples, <span class="dt">prob=</span><span class="fl">0.9</span>)</span>
<span id="cb82-9"><a href="sampling-the-imaginary.html#cb82-9"></a>hpdi90_<span class="dv">1</span></span></code></pre></div>
<pre><code>##      |0.9      0.9| 
## 0.3313313 0.7167167</code></pre>
</div>
<div id="m3." class="section level3">
<h3><span class="header-section-number">4.2.10</span> 3M3.</h3>
<p>Construct a posterior predictive check for this model and data. This means simulate the distribution of samples, averaging over the posterior uncertainty in p. What is the probability of observing 8 water in 15 tosses?</p>
<p><strong>Solution</strong></p>
<p>Propagate parameter uncertainty into predictions by using <code>samples</code> as the probability weightings:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="sampling-the-imaginary.html#cb84-1"></a>w =<span class="st"> </span><span class="kw">rbinom</span>( <span class="fl">1e4</span>, <span class="dt">size=</span><span class="dv">15</span>, <span class="dt">prob=</span>samples)</span>
<span id="cb84-2"><a href="sampling-the-imaginary.html#cb84-2"></a><span class="kw">simplehist</span>(w)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="sampling-the-imaginary.html#cb85-1"></a>prob_<span class="dv">8</span>_<span class="dv">15</span> =<span class="st"> </span><span class="kw">sum</span>(w <span class="op">==</span><span class="st"> </span><span class="dv">8</span>)<span class="op">/</span><span class="kw">length</span>(w)</span>
<span id="cb85-2"><a href="sampling-the-imaginary.html#cb85-2"></a><span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>prob_<span class="dv">8</span>_<span class="dv">15</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 14.7</code></pre>
</div>
<div id="m4." class="section level3">
<h3><span class="header-section-number">4.2.11</span> 3M4.</h3>
<p>Using the posterior distribution constructed from the new (8/15) data, now calculate the probability of observing 6 water in 9 tosses.</p>
<p><strong>Solution</strong>
Use the posterior from 3M1 as the prior for this run, with <code>n_trials = 9</code> and <code>n_water = 6</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="sampling-the-imaginary.html#cb87-1"></a>w =<span class="st"> </span><span class="kw">rbinom</span>( <span class="fl">1e4</span>, <span class="dt">size=</span><span class="dv">9</span>, <span class="dt">prob=</span>samples)</span>
<span id="cb87-2"><a href="sampling-the-imaginary.html#cb87-2"></a><span class="kw">simplehist</span>(w)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="sampling-the-imaginary.html#cb88-1"></a>prob_<span class="dv">6</span>_<span class="dv">9</span> =<span class="st"> </span><span class="kw">sum</span>(w <span class="op">==</span><span class="st"> </span><span class="dv">6</span>)<span class="op">/</span><span class="kw">length</span>(w)</span>
<span id="cb88-2"><a href="sampling-the-imaginary.html#cb88-2"></a><span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>prob_<span class="dv">6</span>_<span class="dv">9</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 17</code></pre>
</div>
<div id="m5." class="section level3">
<h3><span class="header-section-number">4.2.12</span> 3M5.</h3>
<p>Start over at 3M1, but now use a prior that is zero below p = 0.5 and a constant above p = 0.5. This corresponds to prior information that a majority of the Earth’s surface is water. Repeat each problem above and compare the inferences. What difference does the better prior make? If it helps, compare inferences (using both priors) to the true value p = 0.7.</p>
<p><strong>Solution</strong>
Simply pass a prior of the form <code>ifelse( p_grid &lt; 0.5, 0, 1)</code> instead of the uniform prior:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="sampling-the-imaginary.html#cb90-1"></a>out2 =<span class="st"> </span><span class="kw">globe_water_distn</span>(<span class="dv">15</span>, <span class="dv">8</span>, <span class="dt">prior =</span> <span class="kw">ifelse</span>(p_grid <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb90-2"><a href="sampling-the-imaginary.html#cb90-2"></a></span>
<span id="cb90-3"><a href="sampling-the-imaginary.html#cb90-3"></a>n_samples =<span class="st"> </span><span class="fl">1e5</span></span>
<span id="cb90-4"><a href="sampling-the-imaginary.html#cb90-4"></a>samples =<span class="st"> </span><span class="kw">sample</span>( out2[[<span class="st">&quot;p_grid&quot;</span>]], </span>
<span id="cb90-5"><a href="sampling-the-imaginary.html#cb90-5"></a>                  <span class="dt">size=</span>n_samples, </span>
<span id="cb90-6"><a href="sampling-the-imaginary.html#cb90-6"></a>                  <span class="dt">replace=</span><span class="ot">TRUE</span>, </span>
<span id="cb90-7"><a href="sampling-the-imaginary.html#cb90-7"></a>                  <span class="dt">prob=</span>out2[[<span class="st">&quot;posterior&quot;</span>]])</span>
<span id="cb90-8"><a href="sampling-the-imaginary.html#cb90-8"></a></span>
<span id="cb90-9"><a href="sampling-the-imaginary.html#cb90-9"></a></span>
<span id="cb90-10"><a href="sampling-the-imaginary.html#cb90-10"></a><span class="kw">plot</span>( out2<span class="op">$</span>posterior <span class="op">~</span><span class="st"> </span>out2<span class="op">$</span>p_grid, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="sampling-the-imaginary.html#cb91-1"></a>hpdi90_<span class="dv">2</span> =<span class="st"> </span><span class="kw">HPDI</span>( samples, <span class="dt">prob =</span> <span class="fl">0.90</span>)</span>
<span id="cb91-2"><a href="sampling-the-imaginary.html#cb91-2"></a>hpdi90_<span class="dv">2</span></span></code></pre></div>
<pre><code>##      |0.9      0.9| 
## 0.5005005 0.7117117</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="sampling-the-imaginary.html#cb93-1"></a><span class="kw">print</span>(<span class="st">&quot;The uniform prior gave a 90% HPDI of:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The uniform prior gave a 90% HPDI of:&quot;</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="sampling-the-imaginary.html#cb95-1"></a><span class="kw">print</span>(<span class="kw">round</span>(hpdi90_<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## |0.9 0.9| 
## 0.33 0.72</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="sampling-the-imaginary.html#cb97-1"></a><span class="kw">print</span>(<span class="st">&quot;The informed prior gave a 90% HPDI of:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The informed prior gave a 90% HPDI of:&quot;</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="sampling-the-imaginary.html#cb99-1"></a><span class="kw">print</span>(<span class="kw">round</span>(hpdi90_<span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## |0.9 0.9| 
## 0.50 0.71</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="sampling-the-imaginary.html#cb101-1"></a><span class="kw">print</span>(<span class="st">&quot;The informed prior leads to a narrower HPDI indicating that the informed prior leads to lesser uncertainty about the underlying value of the proportion of water on the globe&#39;s surface.&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The informed prior leads to a narrower HPDI indicating that the informed prior leads to lesser uncertainty about the underlying value of the proportion of water on the globe&#39;s surface.&quot;</code></pre>
<p>Now the posterior predictive distribution:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="sampling-the-imaginary.html#cb103-1"></a>w =<span class="st"> </span><span class="kw">rbinom</span>( <span class="fl">1e4</span>, <span class="dt">size=</span><span class="dv">15</span>, <span class="dt">prob=</span>samples)</span>
<span id="cb103-2"><a href="sampling-the-imaginary.html#cb103-2"></a><span class="kw">simplehist</span>(w)</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="sampling-the-imaginary.html#cb104-1"></a>prob_<span class="dv">8</span>_<span class="dv">15</span> =<span class="st"> </span><span class="kw">sum</span>(w <span class="op">==</span><span class="st"> </span><span class="dv">8</span>)<span class="op">/</span><span class="kw">length</span>(w)</span>
<span id="cb104-2"><a href="sampling-the-imaginary.html#cb104-2"></a><span class="kw">round</span>(<span class="dv">100</span><span class="op">*</span>prob_<span class="dv">8</span>_<span class="dv">15</span>, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 15.69</code></pre>
<p>Now 8/15 is not exactly in the center of the posterior predictive distribution. The informative prior tells the model not to completely trust the data, so the simulated posterior sampling distributions are not quite centered on the data.</p>
</div>
<div id="m6." class="section level3">
<h3><span class="header-section-number">4.2.13</span> 3M6.</h3>
<p>Suppose you want to estimate the Earth’s proportion of water very precisely. Specifically, you want the 99% percentile interval of the posterior distribution of p to be only 0.05 wide. This means the distance between the upper and lower bound of the interval should be 0.05. How many times will you have to toss the globe to do this?</p>
<p><strong>Assuming the uniform prior</strong>
Borrowed from <a href="https://www.briancallander.com/posts/statistical-rethinking-2/exercise_3m">Brian Callander</a> and done using tidyverse functions:</p>
<p>Bayesian models are generative, so we can simulate new datasets according to our prior probabilities. We’ll simulate 100 datasets for each value of <span class="math inline">\(N\)</span> of interest. We simulate a dataset by choosing a <code>p_true</code> from our prior, then randomly choosing a <code>w</code> from the corresponding binomial distribution.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="sampling-the-imaginary.html#cb106-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(tidyverse)</span>
<span id="cb106-2"><a href="sampling-the-imaginary.html#cb106-2"></a>m6_prior_predictive =<span class="st"> </span><span class="kw">crossing</span>(</span>
<span id="cb106-3"><a href="sampling-the-imaginary.html#cb106-3"></a>    <span class="dt">N =</span> <span class="dv">200</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">16</span>),</span>
<span id="cb106-4"><a href="sampling-the-imaginary.html#cb106-4"></a>    <span class="dt">iter =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb106-5"><a href="sampling-the-imaginary.html#cb106-5"></a>) <span class="op">%&gt;%</span></span>
<span id="cb106-6"><a href="sampling-the-imaginary.html#cb106-6"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb106-7"><a href="sampling-the-imaginary.html#cb106-7"></a>        <span class="dt">p_true =</span> <span class="kw">runif</span>(<span class="kw">n</span>(), <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">1</span>),</span>
<span id="cb106-8"><a href="sampling-the-imaginary.html#cb106-8"></a>        <span class="dt">W =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), N, p_true)</span>
<span id="cb106-9"><a href="sampling-the-imaginary.html#cb106-9"></a>    )</span></code></pre></div>
<p>For each of these simulated datasets, we grid approximate the posterior, take posterior samples, then calculate the HPDI</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="sampling-the-imaginary.html#cb107-1"></a>granularity =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb107-2"><a href="sampling-the-imaginary.html#cb107-2"></a>m6_grid =<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> granularity)) <span class="op">%&gt;%</span></span>
<span id="cb107-3"><a href="sampling-the-imaginary.html#cb107-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="dv">1</span>)</span>
<span id="cb107-4"><a href="sampling-the-imaginary.html#cb107-4"></a></span>
<span id="cb107-5"><a href="sampling-the-imaginary.html#cb107-5"></a>m6_posteriors =<span class="st"> </span>m6_prior_predictive <span class="op">%&gt;%</span></span>
<span id="cb107-6"><a href="sampling-the-imaginary.html#cb107-6"></a><span class="st">    </span><span class="kw">crossing</span>(m6_grid) <span class="op">%&gt;%</span></span>
<span id="cb107-7"><a href="sampling-the-imaginary.html#cb107-7"></a><span class="st">    </span><span class="kw">group_by</span>(N, p_true, iter) <span class="op">%&gt;%</span></span>
<span id="cb107-8"><a href="sampling-the-imaginary.html#cb107-8"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb107-9"><a href="sampling-the-imaginary.html#cb107-9"></a>        <span class="dt">likelihood =</span> <span class="kw">dbinom</span>(W, N, p),</span>
<span id="cb107-10"><a href="sampling-the-imaginary.html#cb107-10"></a>        <span class="dt">posterior =</span> prior <span class="op">*</span><span class="st"> </span>likelihood</span>
<span id="cb107-11"><a href="sampling-the-imaginary.html#cb107-11"></a>    )</span>
<span id="cb107-12"><a href="sampling-the-imaginary.html#cb107-12"></a></span>
<span id="cb107-13"><a href="sampling-the-imaginary.html#cb107-13"></a>m6_samples =<span class="st"> </span>m6_posteriors <span class="op">%&gt;%</span></span>
<span id="cb107-14"><a href="sampling-the-imaginary.html#cb107-14"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">1000</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">weight=</span>posterior)</span>
<span id="cb107-15"><a href="sampling-the-imaginary.html#cb107-15"></a></span>
<span id="cb107-16"><a href="sampling-the-imaginary.html#cb107-16"></a>m6_hpdi =<span class="st"> </span>m6_samples <span class="op">%&gt;%</span></span>
<span id="cb107-17"><a href="sampling-the-imaginary.html#cb107-17"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">lo =</span> <span class="kw">HPDI</span>(p, <span class="fl">0.99</span>)[<span class="dv">1</span>], <span class="dt">hi =</span> <span class="kw">HPDI</span>(p, <span class="fl">0.99</span>)[<span class="dv">2</span>]) <span class="op">%&gt;%</span></span>
<span id="cb107-18"><a href="sampling-the-imaginary.html#cb107-18"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">width =</span> <span class="kw">abs</span>(hi <span class="op">-</span><span class="st"> </span>lo))</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;N&#39;, &#39;p_true&#39; (override with `.groups` argument)</code></pre>
<p>Now for each value of N, we check how many of the intervals have the desired width:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="sampling-the-imaginary.html#cb109-1"></a>m6_n =<span class="st"> </span>m6_hpdi <span class="op">%&gt;%</span></span>
<span id="cb109-2"><a href="sampling-the-imaginary.html#cb109-2"></a><span class="st">    </span><span class="kw">group_by</span>(N) <span class="op">%&gt;%</span></span>
<span id="cb109-3"><a href="sampling-the-imaginary.html#cb109-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">fraction =</span> <span class="kw">mean</span>(width <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="sampling-the-imaginary.html#cb111-1"></a>gg1 =<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> m6_n,</span>
<span id="cb111-2"><a href="sampling-the-imaginary.html#cb111-2"></a>             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> N, <span class="dt">y =</span> <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>fraction)) <span class="op">+</span></span>
<span id="cb111-3"><a href="sampling-the-imaginary.html#cb111-3"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb111-4"><a href="sampling-the-imaginary.html#cb111-4"></a><span class="st">    </span><span class="kw">geom_line</span>()</span>
<span id="cb111-5"><a href="sampling-the-imaginary.html#cb111-5"></a></span>
<span id="cb111-6"><a href="sampling-the-imaginary.html#cb111-6"></a>gg1</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p><strong>NB.</strong> The hard problems here all use the data below. These data indicate the gender (male=1, female=0) of officially reported first and second born children in 100 two-child families. The data is in the <code>homeworkch3</code> data set:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="sampling-the-imaginary.html#cb112-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(rethinking)</span>
<span id="cb112-2"><a href="sampling-the-imaginary.html#cb112-2"></a><span class="kw">data</span>(homeworkch3)</span>
<span id="cb112-3"><a href="sampling-the-imaginary.html#cb112-3"></a></span>
<span id="cb112-4"><a href="sampling-the-imaginary.html#cb112-4"></a>df =<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb112-5"><a href="sampling-the-imaginary.html#cb112-5"></a>    <span class="dt">birth1 =</span> birth1,</span>
<span id="cb112-6"><a href="sampling-the-imaginary.html#cb112-6"></a>    <span class="dt">birth2 =</span> birth2</span>
<span id="cb112-7"><a href="sampling-the-imaginary.html#cb112-7"></a>) <span class="op">%&gt;%</span></span>
<span id="cb112-8"><a href="sampling-the-imaginary.html#cb112-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">family =</span> <span class="kw">row_number</span>())</span></code></pre></div>
</div>
<div id="h1." class="section level3">
<h3><span class="header-section-number">4.2.14</span> 3H1.</h3>
<p>Using grid approximation, compute the posterior distribution for the probability of a birth being a boy. Assume a uniform prior probability. Which parameter value maximizes the posterior probability?</p>
<p>** Data story**</p>
<ol style="list-style-type: decimal">
<li>The true proportion of boys births in 2-child families is <span class="math inline">\(p\)</span></li>
<li>A single sample of a 2-child family has probability <span class="math inline">\(p\)</span> of having a boy birth, and probaility <span class="math inline">\(1-p\)</span> of having a not boy (girl) birth.</li>
<li>Each family sampled is independent of the others, and each birth within a family is independent in terms of propensity for a particular gender (this may not be quite valid).</li>
</ol>
<p><strong>Model</strong></p>
<p>Let <span class="math inline">\(B\)</span> denote the number of boy births and <span class="math inline">\(G\)</span> denote the number of girl births, and assign the data model:
<span class="math display">\[
 B \sim \text{Binomial}(N,p)
\]</span>
where <span class="math inline">\(N = B + G\)</span>. Suppose we have vague prior information and assume it is uniform:
<span class="math display">\[
p \sim \text{Uniform}(0,1)
\]</span>
Then we can in this case, <span class="math inline">\(N=200\)</span> (2 children in each of 100 families).</p>
<p>Let’s check the total number of boys and girls:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="sampling-the-imaginary.html#cb113-1"></a>h1_birthcounts =<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb113-2"><a href="sampling-the-imaginary.html#cb113-2"></a><span class="st">    </span><span class="kw">summarise</span>(</span>
<span id="cb113-3"><a href="sampling-the-imaginary.html#cb113-3"></a>        <span class="dt">boy_births =</span> <span class="kw">sum</span>(<span class="kw">c</span>(birth1, birth2)),</span>
<span id="cb113-4"><a href="sampling-the-imaginary.html#cb113-4"></a>        <span class="dt">total_births =</span> <span class="kw">length</span>(<span class="kw">c</span>(birth1, birth2))</span>
<span id="cb113-5"><a href="sampling-the-imaginary.html#cb113-5"></a>    )</span>
<span id="cb113-6"><a href="sampling-the-imaginary.html#cb113-6"></a>h1_birthcounts</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   boy_births total_births
##        &lt;dbl&gt;        &lt;int&gt;
## 1        111          200</code></pre>
<p>Now proceed to a grid-approximation of the posterior</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="sampling-the-imaginary.html#cb115-1"></a><span class="co"># define global variables</span></span>
<span id="cb115-2"><a href="sampling-the-imaginary.html#cb115-2"></a>granularity =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb115-3"><a href="sampling-the-imaginary.html#cb115-3"></a></span>
<span id="cb115-4"><a href="sampling-the-imaginary.html#cb115-4"></a><span class="co"># define grid</span></span>
<span id="cb115-5"><a href="sampling-the-imaginary.html#cb115-5"></a>h1_p_grid =<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">1</span>, <span class="dt">length.out=</span>granularity)) <span class="op">%&gt;%</span></span>
<span id="cb115-6"><a href="sampling-the-imaginary.html#cb115-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prior =</span> <span class="dv">1</span>)</span>
<span id="cb115-7"><a href="sampling-the-imaginary.html#cb115-7"></a></span>
<span id="cb115-8"><a href="sampling-the-imaginary.html#cb115-8"></a><span class="co"># grid-approximation of posterior</span></span>
<span id="cb115-9"><a href="sampling-the-imaginary.html#cb115-9"></a>h1_posterior =<span class="st"> </span>h1_p_grid <span class="op">%&gt;%</span></span>
<span id="cb115-10"><a href="sampling-the-imaginary.html#cb115-10"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb115-11"><a href="sampling-the-imaginary.html#cb115-11"></a>        <span class="dt">likelihood =</span> <span class="kw">dbinom</span>(</span>
<span id="cb115-12"><a href="sampling-the-imaginary.html#cb115-12"></a>            <span class="dt">x =</span> h1_birthcounts<span class="op">$</span>boy_births,</span>
<span id="cb115-13"><a href="sampling-the-imaginary.html#cb115-13"></a>            <span class="dt">size =</span> h1_birthcounts<span class="op">$</span>total_births,</span>
<span id="cb115-14"><a href="sampling-the-imaginary.html#cb115-14"></a>            <span class="dt">prob =</span> p),</span>
<span id="cb115-15"><a href="sampling-the-imaginary.html#cb115-15"></a>        <span class="dt">posterior =</span> (prior <span class="op">*</span><span class="st"> </span>likelihood)<span class="op">/</span><span class="kw">sum</span>(prior<span class="op">*</span>likelihood)</span>
<span id="cb115-16"><a href="sampling-the-imaginary.html#cb115-16"></a>    )</span></code></pre></div>
<p>The maximum <em>a posteriori</em> (MAP) estimate is:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="sampling-the-imaginary.html#cb116-1"></a>h1_map =<span class="st"> </span>h1_posterior <span class="op">%&gt;%</span></span>
<span id="cb116-2"><a href="sampling-the-imaginary.html#cb116-2"></a><span class="st">    </span><span class="kw">slice</span>(<span class="kw">which.max</span>(posterior)) <span class="op">%&gt;%</span></span>
<span id="cb116-3"><a href="sampling-the-imaginary.html#cb116-3"></a><span class="st">    </span><span class="kw">pull</span>(p)</span>
<span id="cb116-4"><a href="sampling-the-imaginary.html#cb116-4"></a></span>
<span id="cb116-5"><a href="sampling-the-imaginary.html#cb116-5"></a>h1_map <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.55</code></pre>
<p>Create a plot to show this:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="sampling-the-imaginary.html#cb118-1"></a>h1_ggp =<span class="st"> </span>h1_posterior <span class="op">%&gt;%</span></span>
<span id="cb118-2"><a href="sampling-the-imaginary.html#cb118-2"></a><span class="st">    </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x =</span> p) ) <span class="op">+</span></span>
<span id="cb118-3"><a href="sampling-the-imaginary.html#cb118-3"></a><span class="st">    </span><span class="kw">geom_line</span>( <span class="kw">aes</span>(<span class="dt">y =</span> posterior) ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb118-4"><a href="sampling-the-imaginary.html#cb118-4"></a><span class="st">    </span><span class="kw">geom_area</span>( <span class="kw">aes</span>(<span class="dt">y =</span> posterior), <span class="dt">colour=</span><span class="st">&quot;white&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;steelblue&quot;</span> )</span>
<span id="cb118-5"><a href="sampling-the-imaginary.html#cb118-5"></a></span>
<span id="cb118-6"><a href="sampling-the-imaginary.html#cb118-6"></a></span>
<span id="cb118-7"><a href="sampling-the-imaginary.html#cb118-7"></a>h1_ggp <span class="op">+</span><span class="st"> </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> h1_map),</span>
<span id="cb118-8"><a href="sampling-the-imaginary.html#cb118-8"></a>               <span class="dt">color=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb118-9"><a href="sampling-the-imaginary.html#cb118-9"></a>               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb118-10"><a href="sampling-the-imaginary.html#cb118-10"></a>               <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb118-11"><a href="sampling-the-imaginary.html#cb118-11"></a><span class="st">    </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb118-12"><a href="sampling-the-imaginary.html#cb118-12"></a>             <span class="dt">x =</span> <span class="fl">0.65</span>, <span class="dt">y =</span> <span class="fl">0.012</span>,</span>
<span id="cb118-13"><a href="sampling-the-imaginary.html#cb118-13"></a>             <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">&quot;MAP =&quot;</span>, h1_map <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)),</span>
<span id="cb118-14"><a href="sampling-the-imaginary.html#cb118-14"></a>             <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb118-15"><a href="sampling-the-imaginary.html#cb118-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Probability of a boy birth (p)&quot;</span>,</span>
<span id="cb118-16"><a href="sampling-the-imaginary.html#cb118-16"></a>         <span class="dt">y =</span> <span class="st">&quot;Probability Density&quot;</span>,</span>
<span id="cb118-17"><a href="sampling-the-imaginary.html#cb118-17"></a>         <span class="dt">title =</span> <span class="st">&quot;3H1 Posterior probability of giving birth to a boy&quot;</span>) <span class="op">+</span></span>
<span id="cb118-18"><a href="sampling-the-imaginary.html#cb118-18"></a><span class="st">    </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="h2." class="section level3">
<h3><span class="header-section-number">4.2.15</span> 3H2.</h3>
<p>Using the sample function, draw 10,000 random parameter values from the posterior distribution you calculated above. Use these samples to estimate the 50%, 89%, and 97% highest posterior density intervals.</p>
<p><strong>Solution</strong></p>
<p>Draw samples from the grid weighted according to the posterior probabilities. Can do this following the book as:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="sampling-the-imaginary.html#cb119-1"></a><span class="co"># rethinking approach:</span></span>
<span id="cb119-2"><a href="sampling-the-imaginary.html#cb119-2"></a>n_samples =<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb119-3"><a href="sampling-the-imaginary.html#cb119-3"></a>h2_samples =<span class="st"> </span><span class="kw">with</span>(h1_posterior, </span>
<span id="cb119-4"><a href="sampling-the-imaginary.html#cb119-4"></a>               <span class="kw">sample</span>(p, <span class="dt">prob =</span> posterior, <span class="dt">size=</span>n_samples, <span class="dt">replace=</span><span class="ot">TRUE</span>) )</span></code></pre></div>
<p>and then use <code>rethinking::HPDI()</code> to find highest posterior density intervals for the given levels. However, we can also use a <code>tidyverse</code> approach:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="sampling-the-imaginary.html#cb120-1"></a><span class="co"># tidyverse approach:</span></span>
<span id="cb120-2"><a href="sampling-the-imaginary.html#cb120-2"></a>n_samples =<span class="st"> </span><span class="fl">1e4</span></span>
<span id="cb120-3"><a href="sampling-the-imaginary.html#cb120-3"></a>h2_samples =<span class="st"> </span>h1_posterior <span class="op">%&gt;%</span></span>
<span id="cb120-4"><a href="sampling-the-imaginary.html#cb120-4"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dt">size =</span> n_samples, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">weight=</span>posterior) <span class="op">%&gt;%</span></span>
<span id="cb120-5"><a href="sampling-the-imaginary.html#cb120-5"></a><span class="st">    </span><span class="kw">pull</span>(p)</span>
<span id="cb120-6"><a href="sampling-the-imaginary.html#cb120-6"></a></span>
<span id="cb120-7"><a href="sampling-the-imaginary.html#cb120-7"></a>h2_hpdi =<span class="st"> </span>h2_samples <span class="op">%&gt;%</span></span>
<span id="cb120-8"><a href="sampling-the-imaginary.html#cb120-8"></a><span class="st">    </span><span class="kw">crossing</span>(<span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span>)) <span class="op">%&gt;%</span></span>
<span id="cb120-9"><a href="sampling-the-imaginary.html#cb120-9"></a><span class="st">    </span><span class="kw">group_by</span>(prob) <span class="op">%&gt;%</span></span>
<span id="cb120-10"><a href="sampling-the-imaginary.html#cb120-10"></a><span class="st">    </span><span class="kw">group_map</span>(HPDI)</span>
<span id="cb120-11"><a href="sampling-the-imaginary.html#cb120-11"></a></span>
<span id="cb120-12"><a href="sampling-the-imaginary.html#cb120-12"></a>h2_hpdi</span></code></pre></div>
<pre><code>## [[1]]
##      |0.5      0.5| 
## 0.5005005 0.6126126 
## 
## [[2]]
##     |0.89     0.89| 
## 0.4534535 0.6516517 
## 
## [[3]]
##     |0.97     0.97| 
## 0.4454454 0.6746747</code></pre>
</div>
<div id="h3." class="section level3">
<h3><span class="header-section-number">4.2.16</span> 3H3.</h3>
<p>Use rbinom to simulate 10,000 replicates of 200 births. You should end up with 10,000 numbers, each one a count of boys out of 200 births. Compare the distribution of predicted numbers of boys to the actual count in the data (111 boys out of 200 births). There are many good ways to visualize the simulations, but the dens command (part of the rethinking package) is probably the easiest way in this case. Does it look like the model fits the data well? That is, does the distribution of predictions include the actual observation as a central, likely outcome?</p>
<p><strong>Solution</strong>
Samples from the posterior predictive distribution are “possible” observed counts of boy births from 200 according to the posterior, and it’s easy to generate these (under a uniform prior) by simply setting the <code>prob</code> argument of <code>rbinom()</code> to values in <code>h2_samples</code>, to draw binomial random numbers as follows:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="sampling-the-imaginary.html#cb122-1"></a><span class="co"># posterior predictive samples</span></span>
<span id="cb122-2"><a href="sampling-the-imaginary.html#cb122-2"></a>h3_posterior_predictive =<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb122-3"><a href="sampling-the-imaginary.html#cb122-3"></a>    <span class="dt">predicted_values =</span> <span class="kw">rbinom</span>(<span class="dt">n=</span><span class="fl">1e4</span>, <span class="dt">size=</span><span class="dv">200</span>, <span class="dt">prob=</span>h2_samples) )</span>
<span id="cb122-4"><a href="sampling-the-imaginary.html#cb122-4"></a></span>
<span id="cb122-5"><a href="sampling-the-imaginary.html#cb122-5"></a><span class="co"># plot the posterior predictive distribution and </span></span>
<span id="cb122-6"><a href="sampling-the-imaginary.html#cb122-6"></a><span class="co"># draw a vertical line to indicate the actual observed value of 111 from 200.</span></span>
<span id="cb122-7"><a href="sampling-the-imaginary.html#cb122-7"></a>h3_ggp =<span class="st"> </span>h3_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb122-8"><a href="sampling-the-imaginary.html#cb122-8"></a><span class="st">    </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x =</span> predicted_values) ) <span class="op">+</span></span>
<span id="cb122-9"><a href="sampling-the-imaginary.html#cb122-9"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y=</span>..density..), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;cyan4&quot;</span>) <span class="op">+</span></span>
<span id="cb122-10"><a href="sampling-the-imaginary.html#cb122-10"></a><span class="st">    </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;cyan&quot;</span>) <span class="op">+</span></span>
<span id="cb122-11"><a href="sampling-the-imaginary.html#cb122-11"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> h1_birthcounts<span class="op">$</span>boy_births),</span>
<span id="cb122-12"><a href="sampling-the-imaginary.html#cb122-12"></a>               <span class="dt">color=</span><span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb122-13"><a href="sampling-the-imaginary.html#cb122-13"></a>               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb122-14"><a href="sampling-the-imaginary.html#cb122-14"></a>               <span class="dt">size=</span><span class="fl">1.25</span>) <span class="op">+</span></span>
<span id="cb122-15"><a href="sampling-the-imaginary.html#cb122-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of boys in 200 births&quot;</span>,</span>
<span id="cb122-16"><a href="sampling-the-imaginary.html#cb122-16"></a>         <span class="dt">y =</span> <span class="st">&quot;Probability Density&quot;</span>,</span>
<span id="cb122-17"><a href="sampling-the-imaginary.html#cb122-17"></a>         <span class="dt">title =</span> <span class="st">&quot;3H3: the posterior predictive distribution for 200 births&quot;</span>,</span>
<span id="cb122-18"><a href="sampling-the-imaginary.html#cb122-18"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;The dashed line indicates the actual data: 111 boys born from 200 births&quot;</span>) <span class="op">+</span></span>
<span id="cb122-19"><a href="sampling-the-imaginary.html#cb122-19"></a><span class="st">        </span><span class="kw">theme_minimal</span>()</span>
<span id="cb122-20"><a href="sampling-the-imaginary.html#cb122-20"></a></span>
<span id="cb122-21"><a href="sampling-the-imaginary.html#cb122-21"></a>h3_ggp</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>As can be seen, the actual observed value of 111 boy births from 200 total births is very close to the peak of the posterior predictive distribution, so that indicates that our model is placing most probability in the region that the data indicates is appropriate.</p>
</div>
<div id="h4." class="section level3">
<h3><span class="header-section-number">4.2.17</span> 3H4.</h3>
<p>Now compare 10,000 counts of boys from 100 simulated first borns only to the number of boys in the first births, birth1. How does the model look in this light?</p>
<p><strong>Solution</strong>
So far we’ve considered getting 111 from 200 births, but these come from only 100 families, and we’ve so far ignored any influence of birth order. But we can easily produce a new predictive distribution that only deals with the first 100 births (i.e. the first births in each family):</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="sampling-the-imaginary.html#cb124-1"></a><span class="co"># posterior predictive samples</span></span>
<span id="cb124-2"><a href="sampling-the-imaginary.html#cb124-2"></a>h4_posterior_predictive =<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb124-3"><a href="sampling-the-imaginary.html#cb124-3"></a>    <span class="dt">predicted_values =</span> <span class="kw">rbinom</span>(<span class="dt">n=</span><span class="fl">1e4</span>, <span class="dt">size=</span><span class="dv">100</span>, <span class="dt">prob=</span>h2_samples) )</span>
<span id="cb124-4"><a href="sampling-the-imaginary.html#cb124-4"></a></span>
<span id="cb124-5"><a href="sampling-the-imaginary.html#cb124-5"></a><span class="co"># plot the posterior predictive distribution and </span></span>
<span id="cb124-6"><a href="sampling-the-imaginary.html#cb124-6"></a><span class="co"># draw a vertical line to indicate the actual observed value of 111 from 200.</span></span>
<span id="cb124-7"><a href="sampling-the-imaginary.html#cb124-7"></a>h4_ggp =<span class="st"> </span>h4_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb124-8"><a href="sampling-the-imaginary.html#cb124-8"></a><span class="st">    </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x =</span> predicted_values) ) <span class="op">+</span></span>
<span id="cb124-9"><a href="sampling-the-imaginary.html#cb124-9"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y=</span>..density..), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;cyan4&quot;</span>) <span class="op">+</span></span>
<span id="cb124-10"><a href="sampling-the-imaginary.html#cb124-10"></a><span class="st">    </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;cyan&quot;</span>) <span class="op">+</span></span>
<span id="cb124-11"><a href="sampling-the-imaginary.html#cb124-11"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw">sum</span>(df<span class="op">$</span>birth1)),</span>
<span id="cb124-12"><a href="sampling-the-imaginary.html#cb124-12"></a>               <span class="dt">color=</span><span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb124-13"><a href="sampling-the-imaginary.html#cb124-13"></a>               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb124-14"><a href="sampling-the-imaginary.html#cb124-14"></a>               <span class="dt">size=</span><span class="fl">1.25</span>) <span class="op">+</span></span>
<span id="cb124-15"><a href="sampling-the-imaginary.html#cb124-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of boys in 100 births&quot;</span>,</span>
<span id="cb124-16"><a href="sampling-the-imaginary.html#cb124-16"></a>         <span class="dt">y =</span> <span class="st">&quot;Probability Density&quot;</span>,</span>
<span id="cb124-17"><a href="sampling-the-imaginary.html#cb124-17"></a>         <span class="dt">title =</span> <span class="st">&quot;3H4: the posterior predictive distribution for 100 births&quot;</span>,</span>
<span id="cb124-18"><a href="sampling-the-imaginary.html#cb124-18"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;The dashed line indicates the actual data: 51 boys born from 100 first-born births&quot;</span>) <span class="op">+</span></span>
<span id="cb124-19"><a href="sampling-the-imaginary.html#cb124-19"></a><span class="st">        </span><span class="kw">theme_minimal</span>()</span>
<span id="cb124-20"><a href="sampling-the-imaginary.html#cb124-20"></a></span>
<span id="cb124-21"><a href="sampling-the-imaginary.html#cb124-21"></a>h4_ggp</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="sampling-the-imaginary.html#cb126-1"></a><span class="co">## What&#39;s the probability of between 50 and 52 first births under the posterior ## predictive distribution?</span></span>
<span id="cb126-2"><a href="sampling-the-imaginary.html#cb126-2"></a>h4_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb126-3"><a href="sampling-the-imaginary.html#cb126-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prob_51_100 =</span> <span class="dv">100</span><span class="op">*</span><span class="kw">mean</span>(predicted_values <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span> <span class="op">&amp;</span><span class="st"> </span>predicted_values <span class="op">&lt;</span><span class="st"> </span><span class="dv">52</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   prob_51_100
##         &lt;dbl&gt;
## 1        5.14</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="sampling-the-imaginary.html#cb128-1"></a><span class="co">## What&#39;s the achieved level of significance</span></span>
<span id="cb128-2"><a href="sampling-the-imaginary.html#cb128-2"></a>h4_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb128-3"><a href="sampling-the-imaginary.html#cb128-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prob_als51_100 =</span> <span class="dv">100</span><span class="op">*</span><span class="kw">mean</span>(predicted_values <span class="op">&lt;=</span><span class="st"> </span><span class="dv">51</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   prob_als51_100
##            &lt;dbl&gt;
## 1           25.2</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="sampling-the-imaginary.html#cb130-1"></a><span class="co">## What&#39;s the MAP estimate for the predictive distribution</span></span>
<span id="cb130-2"><a href="sampling-the-imaginary.html#cb130-2"></a>h4_dens =<span class="st"> </span><span class="kw">with</span>(h4_posterior_predictive,</span>
<span id="cb130-3"><a href="sampling-the-imaginary.html#cb130-3"></a>               <span class="kw">density</span>(predicted_values))</span>
<span id="cb130-4"><a href="sampling-the-imaginary.html#cb130-4"></a></span>
<span id="cb130-5"><a href="sampling-the-imaginary.html#cb130-5"></a>h4_dens<span class="op">$</span>x[ <span class="kw">which.max</span>(h4_dens<span class="op">$</span>y) ]</span></code></pre></div>
<pre><code>## [1] 55.71489</code></pre>
<p>Now the fit of the model doesn’t look quite so good. It’s not terrible, but the model MAP estimated number of first-born boys being about 55, and values of 51 or fewer are only expected about <span class="math inline">\(25\%\)</span> of the time. From the predicted values, we only expect to observe 51 first-born male births slightly less than <span class="math inline">\(5\%\)</span> of the time.</p>
</div>
<div id="h5." class="section level3">
<h3><span class="header-section-number">4.2.18</span> 3H5.</h3>
<p>The model assumes that sex of first and second births are independent. To check this assumption, focus now on second births that followed female first borns. Compare 10,000 simulated counts of boys to only those second births that followed girls. To do this correctly, you need to count the number of first borns who were girls and simulate that many births, 10,000 times. Compare the counts of boys in your simulations to the actual observed count of boys following girls. How does the model look in this light? Any guesses what is going on in these data?</p>
<p><strong>Solution</strong>
Let’s check the number of boys born after a girl.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="sampling-the-imaginary.html#cb132-1"></a>h5_birthcounts =<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb132-2"><a href="sampling-the-imaginary.html#cb132-2"></a><span class="st">    </span><span class="kw">filter</span>(birth1 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb132-3"><a href="sampling-the-imaginary.html#cb132-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">boy_births =</span> <span class="kw">sum</span>(birth2), <span class="dt">total_births =</span> <span class="kw">n</span>())</span>
<span id="cb132-4"><a href="sampling-the-imaginary.html#cb132-4"></a></span>
<span id="cb132-5"><a href="sampling-the-imaginary.html#cb132-5"></a>h5_posterior_predictive =<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb132-6"><a href="sampling-the-imaginary.html#cb132-6"></a>    <span class="dt">predicted_values =</span> <span class="kw">rbinom</span>(</span>
<span id="cb132-7"><a href="sampling-the-imaginary.html#cb132-7"></a>        <span class="dt">n =</span> <span class="fl">1e4</span>, </span>
<span id="cb132-8"><a href="sampling-the-imaginary.html#cb132-8"></a>        <span class="dt">size =</span> h5_birthcounts<span class="op">$</span>boy_births,</span>
<span id="cb132-9"><a href="sampling-the-imaginary.html#cb132-9"></a>        <span class="dt">prob =</span> h2_samples)</span>
<span id="cb132-10"><a href="sampling-the-imaginary.html#cb132-10"></a>)</span>
<span id="cb132-11"><a href="sampling-the-imaginary.html#cb132-11"></a></span>
<span id="cb132-12"><a href="sampling-the-imaginary.html#cb132-12"></a>h5_ggp =<span class="st"> </span>h5_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb132-13"><a href="sampling-the-imaginary.html#cb132-13"></a><span class="st">    </span><span class="kw">ggplot</span>( <span class="kw">aes</span>(<span class="dt">x =</span> predicted_values) ) <span class="op">+</span></span>
<span id="cb132-14"><a href="sampling-the-imaginary.html#cb132-14"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y=</span>..density..), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;cyan4&quot;</span>) <span class="op">+</span></span>
<span id="cb132-15"><a href="sampling-the-imaginary.html#cb132-15"></a><span class="st">    </span><span class="kw">geom_density</span>( <span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">fill=</span><span class="st">&quot;cyan&quot;</span>) <span class="op">+</span></span>
<span id="cb132-16"><a href="sampling-the-imaginary.html#cb132-16"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> h5_birthcounts<span class="op">$</span>boy_births),</span>
<span id="cb132-17"><a href="sampling-the-imaginary.html#cb132-17"></a>               <span class="dt">color=</span><span class="st">&quot;darkorange&quot;</span>,</span>
<span id="cb132-18"><a href="sampling-the-imaginary.html#cb132-18"></a>               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb132-19"><a href="sampling-the-imaginary.html#cb132-19"></a>               <span class="dt">size=</span><span class="fl">1.25</span>) <span class="op">+</span></span>
<span id="cb132-20"><a href="sampling-the-imaginary.html#cb132-20"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of 2nd-born boys after female 1st-borns&quot;</span>,</span>
<span id="cb132-21"><a href="sampling-the-imaginary.html#cb132-21"></a>         <span class="dt">y =</span> <span class="st">&quot;Probability Density&quot;</span>,</span>
<span id="cb132-22"><a href="sampling-the-imaginary.html#cb132-22"></a>         <span class="dt">title =</span> <span class="st">&quot;3H5: the posterior predictive distribution&quot;</span>,</span>
<span id="cb132-23"><a href="sampling-the-imaginary.html#cb132-23"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;The dashed line indicates the actual data: 39 boys born following after 49 first-born girls&quot;</span>) <span class="op">+</span></span>
<span id="cb132-24"><a href="sampling-the-imaginary.html#cb132-24"></a><span class="st">        </span><span class="kw">theme_minimal</span>()</span>
<span id="cb132-25"><a href="sampling-the-imaginary.html#cb132-25"></a></span>
<span id="cb132-26"><a href="sampling-the-imaginary.html#cb132-26"></a>h5_ggp</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="03-samplingTheImaginary_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="sampling-the-imaginary.html#cb134-1"></a><span class="co">## What&#39;s the achieved level of significance</span></span>
<span id="cb134-2"><a href="sampling-the-imaginary.html#cb134-2"></a>h5_posterior_predictive <span class="op">%&gt;%</span></span>
<span id="cb134-3"><a href="sampling-the-imaginary.html#cb134-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prob_als39_49 =</span> <span class="dv">100</span><span class="op">*</span><span class="kw">mean</span>(predicted_values <span class="op">&gt;=</span><span class="st"> </span><span class="dv">39</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   prob_als39_49
##           &lt;dbl&gt;
## 1             0</code></pre>
<p>The fit here is very poor, indicating that the assumption of independence of birth gender from first born to second born is not adequate. Indeed, none of the 10000 predicted observations were as high as 39 second-born male births following on from 49 first-born female births. We should stratify this model and fit to first and then second and make that distinction the whole way through.</p>

<div id="refs" class="references">
<div>
<p>Xie, Yihui. 2015. <em>Dynamic Documents with R and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://yihui.org/knitr/">http://yihui.org/knitr/</a>.</p>
</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="small-worlds-and-large-worlds.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["StatisticalRethinking.pdf", "StatisticalRethinking.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
